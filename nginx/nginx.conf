events {
    worker_connections 1024;
}

http {
    upstream dotnet {
        server dotnet:5000;
    }

    upstream nodejs {
        server nodejs:5001;
    }

    upstream python {
        server python:5002;
    }

    upstream java {
        server java:5003;
    }

    upstream go {
        server go:5004;
    }

    server {
        listen 80;
        server_name localhost;

        # Default route to .NET
        location = / {
            proxy_pass http://dotnet;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Node.js route
        location /nodejs {
            proxy_pass http://nodejs;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Python route
        location /python {
            proxy_pass http://python;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Java route
        location /java {
            proxy_pass http://java;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Go route
        location /go {
            proxy_pass http://go;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
